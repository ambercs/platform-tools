
jobs:
- name: cleanup-bosh-director
  serial: true
  plan:
  - in_parallel:
    - get: bosh-repave-repo
    - get: bosh-mgmt
    - get: scheduler
      trigger: true

  - task: cleanup-director
    file: bosh-mgmt/bosh-mgmt/cleanup-bosh-director.yml
    params:
      SKIP_SSL_VALIDATION: ((opsman.skip-ssl-validation))
      OPSMAN_URL: ((opsman.url))
      OPSMAN_USERNAME: ((opsman.username))
      OPSMAN_PASSWORD: ((opsman.password))
      OPSMAN_PRIVATE_KEY: ((opsman.private-key))

- name: repave
  serial: true
  plan:
  - in_parallel:
    - get: bosh-mgmt
    - get: bosh-repave-repo
    - get: scheduler
      trigger: true

  - task: repave
    file: bosh-repave-repo/ci/tasks/repave/task.yml
    params:
      SKIP_SSL_VALIDATION: ((opsman.skip-ssl-validation))
      OPSMAN_URL: ((opsman.url))
      OPSMAN_USERNAME: ((opsman.username))
      OPSMAN_PASSWORD: ((opsman.password))
      OPSMAN_PRIVATE_KEY: ((opsman.private-key))

resource_types:
- name: pivnet
  type: docker-image
  source:
    repository: pivotalcf/pivnet-resource
    tag: latest-final

resources:
- name: bosh-repave-repo
  type: git
  source:
    uri: https://github.com/pivotalservices/bosh-repave.git
    branch: master
- name: bosh-mgmt
  type: git
  source:
    uri: https://github.com/ambercs/platform-tools.git
    branch: main
- name: scheduler
  type: time
  source:
    interval: 168h
    start: 5:00PM
    stop: 6:00PM
    location: America/Chicago
